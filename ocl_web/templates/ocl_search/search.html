{% extends "base.html" %}
{% load bootstrap3 %}
{% load ocl_tags %}

{% block content %}

<!-- Start content row -->

<div class="row">

<!-- Start Left Column -->

	<div class="col-md-3">

<!-- Search Categories -->

		<div class="list-group">
			<a href="{% url 'search' %}?type=concepts{% if request.GET.debug %}&amp;debug=1{% endif %}" class="list-group-item {% if search_type == 'concepts' %}active{% endif %}"><span class="glyphicon glyphicon-tag"></span>&nbsp;&nbsp;Concepts <span class="badge">{{ resource_count.concepts }}</span></a>
			<a href="{% url 'search' %}?type=mappings{% if request.GET.debug %}&amp;debug=1{% endif %}" class="list-group-item {% if search_type == 'mappings' %}active{% endif %}"><span class="glyphicon glyphicon-tag"></span>&nbsp;&nbsp;Mappings <span class="badge">{{ resource_count.mappings }}</span></a>
			<a href="{% url 'search' %}?type=sources{% if request.GET.debug %}&amp;debug=1{% endif %}" class="list-group-item {% if search_type == 'sources' %}active{% endif %}"><span class="glyphicon glyphicon-th-list"></span>&nbsp;&nbsp;Sources <span class="badge">{{ resource_count.sources }}</span></a>
			<a href="{% url 'search' %}?type=collections{% if request.GET.debug %}&amp;debug=1{% endif %}" class="list-group-item {% if search_type == 'collections' %}active{% endif %}"><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;Collections <span class="badge">{{ resource_count.collections }}</span></a>
			<a href="{% url 'search' %}?type=orgs{% if request.GET.debug %}&amp;debug=1{% endif %}" class="list-group-item {% if search_type == 'orgs' %}active{% endif %}"><span class="glyphicon glyphicon-home"></span>&nbsp;&nbsp;Organizations <span class="badge">{{ resource_count.orgs }}</span></a>
			<a href="{% url 'search' %}?type=users{% if request.GET.debug %}&amp;debug=1{% endif %}" class="list-group-item {% if search_type == 'users' %}active{% endif %}"><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;Users <span class="badge">{{ resource_count.users }}</span></a>
  		</div>

<!-- Filters -->

		<div role="form">


         	{% for f in search_filters %}
			<div class="filter-group">
				<div class="filter-group-header">{{ f.name }}</div>
				<div class="filter-group-body">
					{% for c in f.options %}
					<div class="checkbox"><label><input type="checkbox" name="{{ f.filter_id }}"
						value="{{ c.code }}" {% if c.selected %}checked{% endif %}>{{ c.name }}</label></div>
        			{% endfor %}
				</div>
			</div>
			{% endfor %}

		</div> <!-- end div:role=form -->

<!-- End left column -->

	</div>

<!-- Start search results section -->

	<div class="col-md-9">

<!-- Debug -->

	{% if request.GET.debug %}
		<div class="row">
			<div class="col-md-12">
				<pre><strong>API Search Params:</strong><br />{{ search_params|pprint }}</pre>

				<pre><strong>API Search Query:</strong><br />{{ api_search_query|pprint }}</pre>

				<pre><strong>Response Headers:</strong><br />{{ search_response_headers|pprint }}</pre>
			</div>
		</div>
	{% endif %}


<!-- Search Results Summary and Sorting -->

		<div class="row" style="margin-bottom:10px;">
			<div class="col-md-12">
{% if results %}


				<div class="btn-group pull-right">
					  <select name="sort" class="btn btn-default btn-xsm xdropdown-toggle">
					  	{% for o in search_sort_options %}
					    <option {% if search_sort == o %}selected{% endif %}>{{ o }}</option>
					    {% endfor %}
					  </select>
				</div>

                    {% simple_pager page search_type_name url=pagination_url %}

			{% comment %}
			<!-- Jon commented until there are actions that we can perform on resources -->

				<div class="btn-group">
				  &nbsp;&nbsp;
				  <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
				    <strong>Actions</strong> <span class="caret"></span>
				  </button>
				  <ul class="dropdown-menu" role="menu">
				    <li><a href="#">Add to collection</a></li>
				  </ul>
				  &nbsp;&nbsp;
				</div>

			{% endcomment %}

{% else %}
				<h4>We found 0 {{ search_type_name }}{{ 0|pluralize }}.</h4>
{% endif %}
			</div> <!-- /col-md-12 -->
		</div> <!-- /row -->
</form>


<!-- Search Results -->
{% for result in results %}
		<div class="row row-search-result">

	{% if search_type == 'concepts' %}
			<!--div class="col-md-1 search-result-col-checkbox">
				<input type="checkbox" />
			</div-->
			<div class="col-md-1 search-result-col-icon">
				<span class="glyphicon glyphicon-tag search-result-icon"></span>
			</div>
			<div class="col-md-10 search-result-col-content">
				<!--div class="pull-right small text-muted" style="padding-top:12px;">
					<a href="{% url 'concept-detail' org=result.owner source=result.source concept=result.id %}#stars" title="Stars"><span class="glyphicon glyphicon-star"></span>&nbsp;&nbsp;?</a>
					&nbsp;&nbsp;&nbsp;&nbsp;
					<a href="{% url 'concept-detail' org=result.owner source=result.source concept=result.id %}#collections" title="Collections containing this concept"><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;?</a>
				</div-->

				<h4>
					{% if result.owner_type == 'Organization' %}
					    <a href="{% url 'concept-detail' org=result.owner source=result.source concept=result.id %}" style="text-decoration: none;">
					 {% else %}
					    <a href="{% url 'concept-detail' user=result.owner source=result.source concept=result.id %}" style="text-decoration: none;">
			    	{% endif %}
					<span class="resource-label small concept">
						<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-tag"></span></span>&nbsp;&nbsp;<span class="resource-label-id-breadcrumb">{{ result.owner }} / {{ result.source }} / </span><span class="resource-label-id-code">{{ result.id }}</span></span><span class="resource-label-name">{% if result.retired %}<s>{% endif %}{{ result.display_name }}{% if result.retired %}</s>{% endif %}</span>
					</span>
				</a></h4>

				<p>
					<!--span class="caption">{{ result.display_name }} <small><em>[{{ result.display_locale }}]</em></small></span><br /-->
					<em>Class:</em> {{ result.concept_class }}, <em>Datatype:</em> {{ result.datatype }}
					{% if result.description %}<p>{{ result.description }}</p>{% endif %}
					{% comment %}
						<!--em>Collections:</em>
						<a href="{% url 'collection-detail' %}" class="label label-default"><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;Fake / Bogus Value Set</a>
						&nbsp;&nbsp;
						<br /-->
					{% endcomment %}
					<br /><span class="text-muted small"><span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Last updated on {{ result.updated_on|smart_date }}</span>
				</p>
				{% if request.GET.debug %}<pre>{{ result|pprint }}</pre>{% endif %}
			</div>

	{% elif search_type == 'mappings' %}
			<!--div class="col-md-1 search-result-col-checkbox">
				<input type="checkbox" />
			</div-->
			<div class="col-md-1 search-result-col-icon">
				<span class="glyphicon glyphicon-tag search-result-icon"></span>
			</div>
			<div class="col-md-10 search-result-col-content">
				<h4>
					<!-- from_concept -->
					{% if result.from_source_owner_type == 'Organization' %}
					    <a href="#" style="text-decoration: none;">
					 {% else %}
					    <a href="#" style="text-decoration: none;">
			    	{% endif %}
						<span class="resource-label small concept">
							<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-tag"></span></span>&nbsp;&nbsp;<span class="resource-label-id-breadcrumb">{{ result.from_source_owner }} / {{ result.from_source }} / </span><span class="resource-label-id-code">{{ result.from_concept_code }}</span></span><span class="resource-label-name">{% if result.retired %}<s>{% endif %}{{ result.from_concept_name }}{% if result.retired %}</s>{% endif %}</span>
						</span>
					</a>

					<!-- map_type -->
					<span class="resource-label small map-type">
						<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-link"></span></span>&nbsp;&nbsp;<span class="resource-label-id-breadcrumb">{{ result.owner }} / {{ result.source }} / </span></span><span class="resource-label-name">{{ result.result.map_type }}{% if result.retired %}</s>{% endif %}</span>
					</span>

					<!-- to_concept -->
					{% if result.to_source_owner_type == 'Organization' %}
					    <a href="#" style="text-decoration: none;">
					 {% else %}
					    <a href="#" style="text-decoration: none;">
			    	{% endif %}
						<span class="resource-label small concept">
							<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-tag"></span></span>&nbsp;&nbsp;<span class="resource-label-id-breadcrumb">{{ result.to_source_owner }} / {{ result.to_source }} / </span><span class="resource-label-id-code">{{ result.to_concept_code }}</span></span><span class="resource-label-name">{% if result.retired %}<s>{% endif %}{{ result.to_concept_name }}{% if result.retired %}</s>{% endif %}</span>
						</span>
					</a>
				</h4>

				<p>
					<span class="text-muted small"><span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Last updated on {{ result.updated_on|smart_date }}</span>
				</p>
				{% if request.GET.debug %}<pre>{{ result|pprint }}</pre>{% endif %}
			</div>

	{% elif search_type == 'sources' %}
			<!--div class="col-md-1 search-result-col-checkbox">
				<input type="checkbox" />
			</div-->
			<div class="col-md-1 search-result-col-icon">
				<span class="glyphicon glyphicon-th-list search-result-icon"></span>
			</div>
			<div class="col-md-10 search-result-col-content">
				<div class="pull-right small text-muted" style="padding-top:12px;">
					<!--a href="{% url 'source-detail' org=result.owner source=result.id %}#stars" title="Stars"><span class="glyphicon glyphicon-star"></span>&nbsp;&nbsp;&nbsp;</a>
					&nbsp;&nbsp;&nbsp;&nbsp;-->
					<a href="{% url 'source-detail' org=result.owner source=result.id %}#concepts" title="Active concepts in source"><span class="glyphicon glyphicon-tag"></span>&nbsp;&nbsp;{{ result.active_concepts }}</a>
				</div>

				<h4>
					{% if result.owner_type == 'Organization' %}
					    <a href="{% url 'source-detail' org=result.owner source=result.short_code %}" style="text-decoration: none;">
                    {% else %}
					    <a href="{% url 'source-detail' user=result.owner source=result.short_code %}" style="text-decoration: none;">
                    {% endif %}
					<span class="resource-label small source">
						<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-th-list"></span></span>&nbsp;&nbsp;<span class="resource-label-id-breadcrumb">{{ result.owner }} / </span><span class="resource-label-id-code">{{ result.short_code }}</span>
						</span><span class="resource-label-name">{{ result.name }}</span>
					</span>
				</a></h4>

				<p>
					{% if result.description %}{{ result.description }}<br />{% endif %}
					{% if result.updated_on %}<!--br /--><span class="text-muted small"><span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Last updated on {{ result.updated_on|smart_date }}</span>{% endif %}
				</p>
				{% if request.GET.debug %}<pre>{{ result|pprint }}</pre>{% endif %}
			</div>

	{% elif search_type == 'collections' %}
			<!--div class="col-md-1 search-result-col-checkbox">
				<input type="checkbox" />
			</div-->
			<div class="col-md-1 search-result-col-icon">
				<span class="glyphicon glyphicon-tags search-result-icon"></span>
			</div>
			<div class="col-md-10 search-result-col-content">
				<div class="pull-right small text-muted" style="padding-top:12px;">
					<!--a href="{% url 'collection-detail' org=result.owner collection=result.id %}#stars" title="Stars"><span class="glyphicon glyphicon-star"></span>&nbsp;&nbsp;?</a>
					&nbsp;&nbsp;&nbsp;&nbsp;-->
					<a href="{% url 'collection-detail' org=result.owner collection=result.id %}#concepts" title="Concepts in collection"><span class="glyphicon glyphicon-tag"></span>&nbsp;&nbsp;{{ result.active_concepts }}</a>
				</div>

				<h4><a href="{% url 'collection-detail' org=result.owner collection=result.id %}" style="text-decoration: none;">
					<span class="resource-label small collection">
						<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-tags"></span></span>&nbsp;&nbsp;<span class="resource-label-id-breadcrumb">{{ result.owner }} / </span><span class="resource-label-id-code">{{ result.short_code }}</span>
						</span><span class="resource-label-name">{{ result.name }}</span>
					</span>
				</a></h4>

				<p>
					{% if result.description %}{{ result.description }}<br />{% endif %}
					{% if result.updated_on %}<span class="text-muted small"><span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Last updated on {{ result.updated_on|smart_date }}</span>{% endif %}
				</p>
				{% if request.GET.debug %}<pre>{{ result|pprint }}</pre>{% endif %}
			</div>

	{% elif search_type == 'orgs' %}
			<!--div class="col-md-1 search-result-col-checkbox">
				<input type="checkbox" />
			</div-->
			<div class="col-md-1 search-result-col-icon">
				<span class="glyphicon glyphicon-home search-result-icon"></span>
			</div>
			<div class="col-md-10 search-result-col-content">
				<div class="pull-right small text-muted" style="padding-top:12px;">
					<a href="{% url 'org-detail' org=result.id %}#members" title="Members in organization"><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;{{ result.members }}</a>
					&nbsp;&nbsp;&nbsp;&nbsp;
					<!--a href="{% url 'org-detail' org=result.id %}#stars" title="Stars"><span class="glyphicon glyphicon-star"></span>&nbsp;&nbsp;&nbsp;</a>
					&nbsp;&nbsp;&nbsp;&nbsp;-->
					<a href="{% url 'org-detail' org=result.id %}#sources" title="Public sources owned by organization"><span class="glyphicon glyphicon-th-list"></span>&nbsp;&nbsp;{{ result.public_sources }}</a>
					&nbsp;&nbsp;&nbsp;&nbsp;
					<a href="{% url 'org-detail' org=result.id %}#collections" title="Public collections owned by organization"><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;{{ result.public_collections }}</a>
				</div>

				<h4><a href="{% url 'org-detail' org=result.id %}" style="text-decoration: none;">
					<span class="resource-label small organization">
						<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-home"></span></span>&nbsp;&nbsp;<span class="resource-label-id-code">{{ result.id }}</span>
						</span><span class="resource-label-name">{{ result.name }}</span>
					</span>
				</a></h4>

				<p>
					{% if result.description %}<p>{{ result.description|truncatechars:180 }}</p>{% endif %}
					<span class="text-muted small">
						{% if result.location %}<span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;{{ result.location }}
						&nbsp;&nbsp;&nbsp;{% endif %}
						<span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Created on {{ result.created_on|smart_date }}
					</span>
				</p>
				{% if request.GET.debug %}<pre>{{ result|pprint }}</pre>{% endif %}
			</div>

	{% elif search_type == 'users' %}
			<!--div class="col-md-1 search-result-col-checkbox">
				<input type="checkbox" />
			</div-->
			<div class="col-md-1 search-result-col-icon">
				<span class="glyphicon glyphicon-user search-result-icon"></span>
			</div>
			<div class="col-md-10 search-result-col-content">
				<div class="pull-right small text-muted" style="padding-top:12px;">
					<a href="{% url 'user' %}#orgs" title="Organizations"><span class="glyphicon glyphicon-home"></span>&nbsp;&nbsp;{{ result.orgs }}</a>
					&nbsp;&nbsp;&nbsp;&nbsp;
					<!--a href="{% url 'user' %}#followers" title="Followers"><span class="glyphicon glyphicon-star"></span>&nbsp;&nbsp;&nbsp;</a>
					&nbsp;&nbsp;&nbsp;&nbsp;-->
					<a href="{% url 'user' %}#sources" title="Public sources owned by user"><span class="glyphicon glyphicon-th-list"></span>&nbsp;&nbsp;{{ result.public_sources }}</a>
					&nbsp;&nbsp;&nbsp;&nbsp;
					<a href="{% url 'user' %}#collections" title="Public collections owned by user"><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;{{ result.public_collections }}</a>
				</div>

				<h4><a href="{% url 'users:detail' result.username %}" style="text-decoration: none;">
					<span class="resource-label small user">
						<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-user"></span></span>&nbsp;&nbsp;<span class="resource-label-id-code">{{ result.username }}</span>
						</span><span class="resource-label-name">{{ result.name }}</span>
					</span>
				</a></h4>

				<p>
					<span class="text-muted small">
						{% if result.location %}<span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;{{ result.location }}
						&nbsp;&nbsp;&nbsp;{% endif %}
						<span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Joined on {{ result.created_on|smart_date}}
					</span>
				</p>
				{% if request.GET.debug %}<pre>{{ result|pprint }}</pre>{% endif %}
			</div>

	{% endif %}
		</div>
{% empty %}
	
{% endfor %}

<!-- Pagination -->
	        {% if results %}
			<div class="row" style="text-align:center;">
				{% bootstrap_pagination page url=pagination_url %}
			</div>
			{% endif %}

<!-- End search results section -->

	</div>

<!-- End content row -->

</div>

{% endblock content %}
