{% extends "base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load ocl_tags %}

{% block title %}{{ source.owner }} / {{ source.id }} - Open Concept Lab{% endblock title %}

{% block content-no-container %}

<header class="source-header">
	<div class="container">
		<div class="row">
			<div class="col-md-12">

				<div style="width:48px;height:48px;margin-left:0px;margin-top:10px;float:left;font-size:32pt;color:#e5e5e5;"><span class="glyphicon glyphicon-th-list"></span></div>

				<div style="display:inline-block;padding-left:20px">
					<h3>
						{% source_owner_label source %} / {% source_label source %}
						{% if_can_change source %}
						{% if source.owner_type == 'Organization' %}
						<a href="{% url 'source-edit' org=source.owner source=source.id %}" class="small text-muted"><span class="glyphicon glyphicon-cog"></span></a>
						{% else %}
						<a href="{% url 'source-edit' user=source.owner source=source.id %}" class="small text-muted"><span class="glyphicon glyphicon-cog"></span></a>
						{% endif %}
						{% endif_can_change source %}
					</h3>

					<p>
					<span class="text-muted small"><span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Last Updated ({{ source.updated_on|smart_datetime }})</span>
					<span class="org-privacy">public</span>
                	</p>
				</div>

			</div> <!-- /col-md-12 -->
		</div> <!-- /row -->
	</div> <!-- /container -->
</header> <!-- /source-header -->



<!-- Start concepts section -->
<div id="concepts" class="container" ng-app="ConceptApp">

{# tabs #}
<tabset>

<tab heading="Concepts"> {# ----- Start of source concepts tab ----- #}

	<div class="row" ng-controllerx="SourceSearchController">
		<form action="." method="get">

<!-- Filters -->

	    <div class="col-md-3">

	    	{% for f in search_filters %}
			<div class="filter-group">
				<div class="filter-group-header">{{ f.name }}</div>
				<div class="filter-group-body">
					{% for c in f.options %}
					<div class="checkbox"><label><input type="checkbox" name="{{ f.filter_id }}"
						value="{{ c.code }}" {% if c.selected %}checked{% endif %}>{{ c.name }}</label></div>
        			{% endfor %}
				</div>
			</div>
			{% endfor %}

		</div>

<!-- Search selecters -->

		<div class="col-md-9">
			<div class="row" style="padding-top:20px;">
				<div class="col-md-12">

					<div class="btn-group pull-right">
					  	<select name="sort" class="btn btn-default btn-xsm xdropdown-toggle">
					  		{% for o in search_sort_options %}
					    	<option {% if search_sort == o %}selected{% endif %}>{{ o }}</option>
					    	{% endfor %}
					  	</select>
					</div>

					<div class="btn-group pull-right"><span>Sort by:&nbsp;</span></div>

					<div class="btn-group">
					  	<button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
					    	<span class="text-muted">Version:</span> <strong>Latest</strong> <span class="caret"></span>
					  	</button>
					  	<ul class="dropdown-menu" role="menu">
					    	<li><a href="#">Head</a></li>
					    	<li><a href="#">Latest Version</a></li>
					    	<li><a href="#">An older version</a></li>
					  	</ul>
					</div>

				</div>
			</div>

			<div class="row">
				<div class="col-md-12" style="padding-top:20px;padding-bottom:20px;">

                    {% simple_pager page 'concept' url=pagination_url %}


			        <div class="input-group">
			            <input type="text" name="q" class="form-control" placeholder="Search concepts within source" value="{{ q }}">
			            <span class="input-group-btn">
                            <button class="btn btn-default" type="submit" >Search</button>
                        </span>
                    </div>
				</div>
			</div>
	</form>

			<div class="row">
				<div class="col-md-12">

					{% if_can_change source %}
					<div class="pull-right">
						<a class="btn btn-link" 

						{% if source.owner_type == 'Organization' %}
						href="{% url 'concept-create-for-org' source.owner source.id %}"
						{% else %}
						href="{% url 'concept-create-for-user' source.owner source.id %}"
						{% endif %}
						><span class="glyphicon glyphicon-plus"></span>
						{% trans 'Add Concept' %}</a>
					</div>
					{% endif_can_change %}
				</div>
			</div>

	<!-- Display source search results -->

	        {% for result in concepts %}
				<div class="row row-search-result">
					<div class="col-md-1 search-result-col-checkbox">
						<input type="checkbox" />
					</div>
					<div class="col-md-1 search-result-col-icon">
						<span class="glyphicon glyphicon-tag search-result-icon"></span>
					</div>
					<div class="col-md-10 search-result-col-content">
						<!--div class="pull-right small text-muted" style="padding-top:12px;">
							<a href="{% url 'concept-detail' org=result.owner source=result.source concept=result.id %}#stars" title="Stars"><span class="glyphicon glyphicon-star"></span>&nbsp;&nbsp;?</a>
							&nbsp;&nbsp;&nbsp;&nbsp;
							<a href="{% url 'concept-detail' org=result.owner source=result.source concept=result.id %}#collections" title="Collections containing this concept"><span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;?</a>
						</div-->

						<h4>
							{% if result.owner_type == 'Organization' %}
							<a href="{% url 'concept-detail' org=result.owner source=result.source concept=result.id %}" style="text-decoration: none;">
							{% else %}
        						<a href="{% url 'concept-detail' user=result.owner source=result.source concept=result.id %}" style="text-decoration: none;">
							{% endif %}

							<span class="resource-label small concept">
								<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-tag"></span></span>&nbsp;&nbsp;<span class="resource-label-id-breadcrumb">{{ result.owner }} / {{ result.source }} / </span><span class="resource-label-id-code">{{ result.id }}</span></span><span class="resource-label-name">{% if result.retired %}<s>{% endif %}{{ result.display_name }}{% if result.retired %}</s>{% endif %}</span>
							</span>
						</a></h4>

						<p>
							<em>Class:</em> {{ result.concept_class }}, <em>Datatype:</em> {{ result.datatype }}<br />
							{% if result.updatedOn %}<br /><span class="text-muted small"><span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Last Updated {{ result.updatedOn }}</span>{% endif %}
						</p>
						{% if request.GET.debug %}<pre>{{ result|pprint }}</pre>{% endif %}
					</div>
				</div> <!-- /row -->
			{% empty %}
				{% trans 'No concepts found' %}
			{% endfor %}

	<!-- Pagination -->

	        {% if concepts %}
			<div class="row" style="text-align:center;">
				{% bootstrap_pagination page url=pagination_url %}
			</div>
			{% endif %}
		</div>
	</div> <!-- /row -->

</tab> {# ----- end source Concepts tab #}


<tab heading="Mappings"> {# ----- start source mappings tab #}
	<p>&nbsp;</p>
	<div class="panel panel-default">
	  	<div class="panel-body" style="height:140px;">
	  		<h4>Mappings</h4>
	    	<p>[Mappings stored in this source will be displayed here]</p>
	  	</div>
	</div>
</tab> {# ----- end source mappings tab #}


<tab heading="Source Details"> {# ----- start source details tab #}
	<div class="row">&nbsp;</div>
	{% field_label 'Full Name' source.full_name %}
	{% field_label 'Description' source.description %}
	{% field_label 'Source Type' source.source_type %}
	{% field_label 'Website' source.website url=True %}
	{% field_label 'External ID' source.external_id %}
	{% field_label 'Source URL' source.url %}
	{% field_label 'Created By' source.created_by %}
	{% field_label 'Created on' source.created_on|smart_date %}
	{% field_label 'Updated by' source.created_by %}
	{% field_label 'Updated on' source.created_on|smart_date %}

	{% include 'core/resource_detail_extra.html' %}
</tab> {# ----- end source details tab #}


{% include 'sources/source_detail_version.html' %}


<tab heading="About"> {# ----- start source About tab #}
	<p>&nbsp;</p>
	<div class="panel panel-default">
		<div class="panel-heading"><h4 class="panel-title">About</h4></div>
	  	<div class="panel-body" style="min-height:140px;">{{ about|safe }}</div>
	</div> {# end panel #}
</tab> {# ----- end source About tab #}


{% if request.GET.debug %}
<tab heading="Debug"> {# ----- start source Debug tab #}
	<p>&nbsp;</p>
	<div class="panel panel-default">
		<div class="panel-heading"><h4 class="panel-title">Debug</h4></div>
	  	<div class="panel-body" style="min-height:140px;"><pre style="border:0; background-color:transparent;">{{ source|pprint }}</pre></div>
	</div>
</tab> {# ----- end source Debug tab #}
{% endif %}


</tabset>
</div> <!-- /container -->

{% endblock content-no-container %}