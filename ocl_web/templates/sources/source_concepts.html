{% extends "sources/source_base.html" %}
{% load i18n %}
{% load ocl_tags %}
{% load bootstrap3 %}


{% block tab-content %}
<div class="container">
<div class="row" ng-controllerx="SourceSearchController">
	<form action="." method="get">

<!-- Start left column -->

    <div class="col-md-3">

<!-- Filters -->

		{% for facet in search_facets %}
		<div class="filter-group">
			<div class="filter-group-header">{{ facet.search_filter_name }}</div>
			<div class="filter-group-body">
				{% for facet_key, facet_option in facet.options.iteritems %}
					{% if facet_option.option_num > 0 %}
						<div class="checkbox"><label><input type="checkbox" name="{{ facet.search_filter_name }}" value="{{ facet_option.option_value }}" {% if facet_option.selected %}checked{% endif %}>{{ facet_option.option_name }}&nbsp;&nbsp;&nbsp;&nbsp;<span class="text-muted">{{ facet_option.option_num }}</span></label></div>
					{% endif %}
				{% endfor %}
			</div>
		</div>
		{% endfor %}

<!-- End left column -->

	</div>

<!-- Start right column -->

	<div class="col-md-9">

<!-- Search selecters -->

		<div class="row" style="padding-top:20px;">
			<div class="col-md-12">
				<div class="btn-group pull-right">
				  	<select name="sort" class="btn btn-default btn-xsm xdropdown-toggle">
				  		{% for o in search_sort_options %}
				    	<option {% if search_sort == o %}selected{% endif %}>{{ o }}</option>
				    	{% endfor %}
				  	</select>
				</div>
				<div class="btn-group pull-right"><span>Sort by:&nbsp;</span></div>
				<div class="btn-group">
				  	<button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
				    	<span class="text-muted">Source Version:</span> <strong>Latest</strong> <span class="caret"></span>
				  	</button>
				  	<ul class="dropdown-menu" role="menu">
				  	{% for source_version in source_versions %}
				  		<li><a href="#">{% if source_version.released %}<strong>{% endif %}{{ source_version.id }}{% if source_version.released %} <span class="text-muted">(Released)</span></strong>{% endif %}</a></li>
				    {% endfor %}
				  	</ul>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-12" style="padding-top:20px;padding-bottom:20px;">
                {% simple_pager current_page 'concept' url=pagination_url %}
		        <div class="input-group">
		            <input type="text" name="q" class="form-control" placeholder="Search concepts within source" value="{{ search_query }}">
		            <span class="input-group-btn">
                        <button class="btn btn-default" type="submit" >Search</button>
                    </span>
                </div>
			</div>
		</div>

		{% if_can_change source %}
		<div class="row">
			<div class="col-md-12">
				{% if source.owner_type == 'Organization' %}
					{% url 'concept-create-for-org' source.owner source.id as add_concept_url %}
				{% else %}
					{% url 'concept-create-for-user' source.owner source.id as add_concept_url %}
				{% endif %}
				<div class="pull-right"><a class="btn btn-link" href="{{ add_concept_url }}"><span class="glyphicon glyphicon-plus"></span>{% trans 'Add Concept' %}</a></div>
			</div>
		</div>
		{% endif_can_change %}

<!-- Source concept search results -->

        {% for result in results %}
			{% if source.owner_type == 'Organization' %}
				{% url 'concept-detail' org=result.owner source=result.source concept=result.id as concept_url %}
			{% else %}
				{% url 'concept-detail' user=result.owner source=result.source concept=result.id as concept_url %}
			{% endif %}

			<div class="row row-search-result">
				<!--div class="col-md-1 search-result-col-checkbox"><input type="checkbox" /></div-->
				<div class="col-md-1 search-result-col-icon"><span class="glyphicon glyphicon-tag search-result-icon"></span></div>
				<div class="col-md-10 search-result-col-content">
					<h4><a href="{{ concept_url }}" style="text-decoration: none;">
						<span class="resource-label small concept">
							<span class="resource-label-id"><span class="resource-label-id-icon"><span class="glyphicon glyphicon-tag"></span></span>&nbsp;&nbsp;<span class="resource-label-id-breadcrumb">{{ result.owner }} / {{ result.source }} / </span><span class="resource-label-id-code">{{ result.id }}</span></span><span class="resource-label-name">{% if result.retired %}<s>{% endif %}{{ result.display_name }}{% if result.retired %}</s>{% endif %}</span>
						</span>
					</a></h4>
					<p>
						<em>Class:</em> {{ result.concept_class }}, <em>Datatype:</em> {{ result.datatype }}<br />
						{% if result.updatedOn %}<br /><span class="text-muted small"><span class="glyphicon glyphicon-calendar"></span>&nbsp;&nbsp;Last Updated {{ result.updatedOn }}</span>{% endif %}
					</p>
					{% if request.GET.debug %}<pre>{{ result|pprint }}</pre>{% endif %}
				</div>
			</div>
		{% empty %}
			{% trans 'No concepts found' %}
		{% endfor %}

	<!-- Pagination -->

	        {% if results %}
			<div class="row" style="text-align:center;">
				{% bootstrap_pagination current_page url=pagination_url %}
			</div>
			{% endif %}
		</div>

	</form>
</div>
</div>
{% endblock tab-content %}


{% block resource-debug %}
<h4>URL Parameters</h4><pre>{{ url_params|pprint }}</pre>
<h4>Source</h4><pre>{{ source|pprint }}</pre>
<h4>Concepts</h4><pre>{{ results|pprint }}</pre>
<h4>Facets</h4><pre>{{ search_facets|pprint }}</pre>
{% endblock resource-debug %}
